package com.example.mysatoro

import androidx.compose.foundation.background
import androidx.compose.foundation.layout.*
import androidx.compose.foundation.rememberScrollState
import androidx.compose.foundation.verticalScroll
import androidx.compose.material3.*
import androidx.compose.material3.RadioButton
import androidx.compose.material3.Checkbox
import androidx.compose.runtime.*
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.graphics.Brush
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.res.painterResource
import androidx.compose.ui.text.font.FontStyle
import androidx.compose.ui.text.font.FontWeight
import androidx.compose.ui.unit.dp
import androidx.compose.ui.unit.sp
import androidx.compose.ui.layout.ContentScale
import androidx.navigation.NavController
import androidx.compose.foundation.Image
import androidx.compose.runtime.getValue
import androidx.compose.runtime.mutableStateOf
import androidx.compose.runtime.setValue
import androidx.compose.runtime.saveable.rememberSaveable



@Composable
fun SeguimientoScreen(navController: NavController) {
    var diaAnsiedad by rememberSaveable { mutableStateOf("") }
    var herramienta by rememberSaveable { mutableStateOf("") }
    var nivelAnsiedad by rememberSaveable { mutableStateOf(0) }
    var herramientasUsadas by rememberSaveable { mutableStateOf(mutableSetOf<String>()) }
    var mostrarResultado by rememberSaveable { mutableStateOf(false) }

    val dias = listOf("Lunes", "Martes", "MiÃ©rcoles", "Jueves", "Viernes", "SÃ¡bado", "Domingo")
    val herramientas = listOf("Respirar", "Escuchar audios", "OÃ­r mÃºsica", "Diario emocional")

    Column(
        modifier = Modifier
            .fillMaxSize()
            .verticalScroll(rememberScrollState())
            .background(
                brush = Brush.verticalGradient(
                    colors = listOf(
                        Color(0xFF3F27A8),
                        Color(0xFFB48CF2),
                        Color(0xFF00C2FA)
                    ),
                    startY = 0f,
                    endY = Float.POSITIVE_INFINITY
                )
            )
            .padding(16.dp)
    ) {
        Button(
            onClick = { navController.popBackStack() },
            modifier = Modifier.padding(bottom = 8.dp)
        ) {
            Text("Volver", fontSize = 18.sp)
        }

        Image(
            painter = painterResource(id = R.drawable.encabezado_seguimiento),
            contentDescription = null,
            modifier = Modifier
                .fillMaxWidth()
                .height(180.dp),
            contentScale = ContentScale.FillWidth
        )

        Spacer(modifier = Modifier.height(16.dp))

        Text("ğŸ—“ Â¿QuÃ© dÃ­a sentiste mÃ¡s ansiedad?", fontSize = 18.sp, fontWeight = FontWeight.Bold, color = Color.White)
        dias.forEach { dia ->
            Row(verticalAlignment = Alignment.CenterVertically) {
                RadioButton(selected = diaAnsiedad == dia, onClick = { diaAnsiedad = dia })
                Text(dia, color = Color.White)
            }
        }

        Spacer(modifier = Modifier.height(16.dp))

        Text("ğŸ§° Â¿QuÃ© herramienta te ayudÃ³ mÃ¡s?", fontSize = 18.sp, fontWeight = FontWeight.Bold, color = Color.White)
        herramientas.take(3).forEach { h ->
            Row(verticalAlignment = Alignment.CenterVertically) {
                RadioButton(selected = herramienta == h, onClick = { herramienta = h })
                Text(h, color = Color.White)
            }
        }

        Spacer(modifier = Modifier.height(16.dp))

        Text("ğŸ“Š Â¿CÃ³mo calificarÃ­as tu ansiedad esta semana? (1-5)", fontSize = 18.sp, fontWeight = FontWeight.Bold, color = Color.White)
        (1..5).forEach { nivel ->
            Row(verticalAlignment = Alignment.CenterVertically) {
                RadioButton(selected = nivelAnsiedad == nivel, onClick = { nivelAnsiedad = nivel })
                Text("Nivel $nivel", color = Color.White)
            }
        }

        Spacer(modifier = Modifier.height(16.dp))

        Text("ğŸ›  Â¿QuÃ© herramientas usaste esta semana?", fontSize = 18.sp, fontWeight = FontWeight.Bold, color = Color.White)
        herramientas.forEach { h ->
            Row(verticalAlignment = Alignment.CenterVertically) {
                Checkbox(
                    checked = herramientasUsadas.contains(h),
                    onCheckedChange = {
                        if (it) herramientasUsadas.add(h)
                        else herramientasUsadas.remove(h)
                    }
                )
                Text(h, color = Color.White)
            }
        }

        Spacer(modifier = Modifier.height(24.dp))

        Button(onClick = { mostrarResultado = true }, modifier = Modifier.fillMaxWidth()) {
            Text("Ver Seguimiento")
        }

        Spacer(modifier = Modifier.height(24.dp))

        if (mostrarResultado) {
            val estado = when (nivelAnsiedad) {
                1 -> "ğŸ˜Š Tranquilidad mÃ¡xima"
                2 -> "ğŸ™‚ Bien manejado"
                3 -> "ğŸ˜ PodrÃ­a mejorar"
                4 -> "ğŸ˜Ÿ Nivel alto"
                5 -> "ğŸ˜¢ Mucha ansiedad"
                else -> ""
            }

            val frase = when (herramienta) {
                "Respirar" -> "â€œCada respiraciÃ³n consciente te acerca a la calma.â€"
                "Escuchar audios" -> "â€œPermÃ­tete sentir y soltar.â€"
                "OÃ­r mÃºsica" -> "â€œDonde las palabras fallan, la mÃºsica habla.â€"
                else -> "â€œEstÃ¡s haciendo lo mejor que puedes, y eso es suficiente.â€"
            }

            Text("ğŸ§¾ Resumen de tu semana", fontSize = 20.sp, fontWeight = FontWeight.Bold, color = Color.White)
            Text("ğŸ“… DÃ­a con mÃ¡s ansiedad: $diaAnsiedad", color = Color.White)
            Text("ğŸ›  Herramienta que mÃ¡s ayudÃ³: $herramienta", color = Color.White)
            Text("ğŸ“ˆ Nivel de ansiedad: $nivelAnsiedad", color = Color.White)
            Text("ğŸ¯ Estado emocional: $estado", color = Color.White)
            Text("ğŸ§° Herramientas que usaste: ${herramientasUsadas.joinToString(", ")}", color = Color.White)
            Text("ğŸ’¬ Frase motivadora: $frase", color = Color.White, fontStyle = FontStyle.Italic)
        }
    }
}
